language: node_js
sudo: required
script:
- "./_scripts/run-tests.sh"
branches:
  except:
  - master
node_js:
- '6.1'
before_install:
- if [[ `npm -v` != 3* ]]; then npm i -g npm@3; fi
- rvm install 2.1
- rvm use 2.1
- ". $HOME/.nvm/nvm.sh && nvm install 6.1 && nvm use 6.1"
- gem install bundler
- bundle check || bundle install
- chmod +x build.sh
- chmod +x run-tests.sh

env:
  global:
  - NOKOGIRI_USE_SYSTEM_LIBRARIES=true
  - secure: R27dLNLiZx/ugOrYYJgooDX6u7zzFHWvmCUMjPOftbW4RYsow6F4X9Lfej56FDKFVFGGQ154z5Ka7jgvCpqMhMpT2hfgKCmHoWHmo7TSZF+GTILwvn1LGgtJfMgmYMP8ohCuq5FmxmE2Ox6PW8B/Ap4iT7Rem7Fp69V5Qnle1n28GlfqRCO+0vfnJaR4xGLreaUFYxXN5Emqs3eK7VECfUxklGBrzJCS76GLIx5m/NcmZsYgD3llDtj6+vUZUuUJPZmBe5MESYqL09rJXhNt35ZKE8VXpqCFhTFpr8SO/eb7AHcBFdsc46EYCxfK1RPyeM9F5qhGE5zdVNMEoQoPoQffPeoL1KTLQTFpgnDIpjI+Jm6nkYTeUYiBCEjJZ5hJ4yfGqK1NbURtZGKjBbegTficZZjisW9Yf1Bc2itpphm4TjXcOIPRys8pLxRvATQXBv8qLSDLz6FGqyx5N73rkJ6MAALkuuhsLtjhCK+gqU47X7DkwNXDcA5u7MoRxXx+s4NvvERjilsa8YwPvFpW7WNRdsgexV/sF24aWdUNA8xkMW5iw0ZM1vhdaJKnDUkJjb3FgBjWrbEqIx7ubbuVVWGW5AHzU5moppJ8/p6roRHxGd8Nj9xCpl+SBJNnNtHylFqtshfo0U4nEOUK+YJ8ftohTYNLQcvZPZySsUmJQus=
  - secure: AOK7fOjjTbxR7fyrZ5TvkgOMAqcAFMAox91pVcw+FpmNFnRy8kQLoJgsz0cI2tVyj4dpUePdQeGN9JntCJLh+4Q+4JI8uswH/p7TjcUuhudZrcku5zf42C4YV+GKrWXHGQLMv9GVhb9Q/4J9U97C8sosFC8Js6tlBPkP4IlLzSRiZrGXP+kjPOFLsJWYO6x+iUjR3CbJYrY1z9S9/UfWrCzI5Ycy1d7RecsNp+qixgYa+kwLyaM22SQze+sHyBvPFCFRJD/2aPVQ3HINi7jS+yCIFk6MAhw1vseGUbvfDUPL0lu8INrUmQ7U+Qh5QXGTvAF7vzc4wq+iP84noFnuwUPvD+OMMq54Hr9DS5tiQDuJa7xD0s2bykWtnx27mW+hG20FZpIej9mS2PuGL8tKIbxKId2bu8+KDr5EhXcCzFSYSQXZoqyQFhCUKqVLwKMPGmnC8V/6bWHS4LNN4mh3s28wSJexP3MME6Os3Z87ADXDcDsKGjpB8qC7a/UPWq/ZFMCykbbabom41zumJ0Nh4JRjb7Jaha0MabSkoXrxoYuqW5a1O9xTUQk8fadWLhfrFENimz8Zasb6a9iD9xp+yyuSl1ntpcm5H/G+vvH3F+xpCb2BE/cy+sH30DzQERGSh01PafNV+X5ou2nSmK6VGZTfOWXZ7LuTAVXmIr8kj2k=
deploy:
  provider: script
  script: "./_scripts/build.sh"
  skip_cleanup: false
  on:
    branch: source
